id: amplitude
namespace: des.amplitude

tasks:
  - id: wdir
    type: io.kestra.plugin.core.flow.WorkingDirectory
    tasks:
      - id: hello
        type: io.kestra.plugin.core.log.Log
        message: Hello World! üöÄ

      - id: clone
        type: io.kestra.plugin.git.Clone
        url: https://github.com/dalycaolan/amplitude-extract-project
        branch: modularising-script
        username: "{{ kv('github_user')}}"
        password: "{{kv('github_token')}}"

      - id: python_scripts
        type: io.kestra.plugin.scripts.python.Commands
        env:
          AMP_API_KEY: "{{kv('AMP_API_KEY')}}"
          AMP_SECRET_KEY: "{{kv('AMP_SECRET_KEY')}}"
          AWS_ACCESS_KEY: "{{kv('AWS_ACCESS_KEY')}}"
          AWS_SECRET_KEY: "{{kv('AWS_SECRET_KEY')}}"
          BUCKET_NAME: "{{kv('BUCKET_NAME')}}"
        beforeCommands:
          - pip install -r requirements.txt
        commands:
          - echo "packages installed, starting main script ‚òòÔ∏è"
          - python main.py
          - echo "Files uploaded, ending Python script ‚òòÔ∏è‚òòÔ∏è‚òòÔ∏è"
# triggers:
#   - id: every_15_minutes
#     type: io.kestra.plugin.core.trigger.Schedule
#     cron: "*/15 * * * *"
